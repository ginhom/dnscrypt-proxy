<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>DNSCrypt by jedisct1</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/jedisct1/dnscrypt-proxy">View On GitHub</a></li>
          <li class="downloads"><a href="/dnscrypt-proxy/downloads/">Download packages</a></li>
          <li class="title">Current version: <strong>1.2.0</strong></li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>DNSCrypt</h1>
          <p>A tool for securing communications between a client and a DNS resolver</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/jedisct1">jedisct1</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <h1>DNSCrypt</h1>

<p>A tool for securing communications between a client and a DNS resolver.</p>

<h2>Description</h2>

<p>dnscrypt-proxy provides local service which can be used directly as
your local resolver or as a DNS forwarder, encrypting and
authenticating requests using the DNSCrypt protocol and passing them
to an upstream server, by default <a
href="https://www.opendns.com">OpenDNS</a> who run this on their resolvers.</p>

<p>The DNSCrypt protocol uses high-speed high-security elliptic-curve
cryptography and is very similar to <a href="http://dnscurve.org">DNSCurve</a>,
but focuses on securing communications between a client and its first-level
resolver.</p>

<p>While not providing end-to-end security, it protects the local
network, which is often the weakest point of the chain, against
man-in-the-middle attacks. It also provides some confidentiality to
DNS queries.</p>

<h2>GUIs for dnscrypt-proxy</h2>

<p>If you need a simple graphical user interface in order to start/stop
the proxy and change your DNS settings, check out the following
projects:</p>

<ul>
<li><p><a href="http://opendns.github.com/dnscrypt-osx-client/">DNSCrypt OSX Client</a>:
a preferences pane, a menu bar indicator and a service to change the
DNS settings. OSX only, written in Objective C. Experimental.</p></li>
<li><p><a href="https://github.com/Noxwizard/dnscrypt-winclient">DNSCrypt WinClient</a>:
Easily enable/disable DNSCrypt on multiple adapters. Supports
different ports and protocols, IPv6, parental controls and the proxy
can act as a gateway service. Windows only, written in .NET.</p></li>
<li><p><a href="https://github.com/opendns/dnscrypt-win-client">DNSCrypt Win Client</a>:
Official GUI for Windows, by OpenDNS. Also known as "OpenDNSCrypt".</p></li>
<li><p><a href="http://modmyi.com/cydia/com.guizmo.dns">GuizmoDNS</a>:
available on Cydia, for jailbroken iPhone/iPad/iPod Touch devices.</p></li>
</ul>

<h2>Server-side proxies</h2>
<ul>
<li>Yencheng Fu wrote <a
href="https://github.com/Cofyc">dnscrypt-wrapper</a>, a server-side
dnscrypt proxy that works with any name resolver.</li>
</ul>

<h2>Installation</h2>

<p>The daemon is known to work on recent versions of OSX, OpenBSD, Bitrig,
NetBSD, Dragonfly BSD, FreeBSD, Linux, iOS (requires a jailbroken
device), Android (rooted), Solaris (SmartOS) and Windows (requires MingW).</p>

<p>Download the
<a href="/dnscrypt-proxy/downloads/">latest version</a>
and extract it:</p>

<pre><code>$ bunzip2 -cd dnscrypt-proxy-*.tar.bz2 | tar xvf -
$ cd dnscrypt-proxy-*
</code></pre>

<p>Compile and install it using the standard procedure:</p>

<pre><code>$ ./configure &amp;&amp; make -j2
# make install
</code></pre>

<p>Replace <code>-j2</code> with whatever number of CPU cores you want to use for the
compilation process.</p>

<p>Running <code>make -j2 test</code> in the <code>src/libnacl</code> directory is also highly
recommended.</p>

<p>The proxy will be installed as <code>/usr/local/sbin/dnscrypt-proxy</code> by default.</p>

<p>Command-line switches are documented in the <code>dnscrypt-proxy(8)</code> man page.</p>

<h2>Usage</h2>

<p>Having a dedicated system user, with no privileges and with an empty
home directory, is highly recommended. For extra security, DNSCrypt
will chroot() to this user's home directory and drop root privileges
for this user's uid as soon as possible.</p>

<p>The easiest way to start the daemon is:</p>

<pre><code># dnscrypt-proxy --daemonize
</code></pre>

<p>The proxy will accept incoming requests on 127.0.0.1, tag them with an
authentication code, forward them to OpenDNS resolvers, and validate
each answer before passing it to the client.</p>

<p>Given such a setup, in order to actually start using DNSCrypt, you
need to update your <code>/etc/resolv.conf</code> file and replace your current
set of resolvers with:</p>

<pre><code>nameserver 127.0.0.1
</code></pre>

<p>Other common command-line switches include:</p>

<ul>
<li>
<code>--daemonize</code> in order to run the server as a background process.</li>
<li>
<code>--local-address=&lt;ip&gt;[:port]</code> in order to locally bind a different IP
address than 127.0.0.1</li>
<li>
<code>--logfile=&lt;file&gt;</code> in order to write log data to a dedicated file. By
default, logs are sent to stdout if the server is running in foreground,
and to syslog if it is running in background.</li>
<li>
<code>--max-active-requests=&lt;count&gt;</code> to set the maximum number of active
requests. The default value is 250.</li>
<li>
<code>--pid-file=&lt;file&gt;</code> in order to store the PID number to a file.</li>
<li>
<code>--user=&lt;user name&gt;</code> in order to chroot()/drop privileges.</li>
</ul><p>DNSCrypt comes pre-configured for OpenDNS, although the
<code>--resolver-address=&lt;ip&gt;[:port]</code>,
<code>--provider-name=&lt;certificate provider FQDN&gt;</code>
and <code>--provider-key=&lt;provider public key&gt;</code> can be specified in
order to change the default settings.</p>

<h2><a name="windows-service" class="anchor" href="#windows-service"><span
class="mini-icon mini-icon-link"></span></a>Installation as a service
(Windows only)</h2>

<p>The proxy can be installed as a Windows service.</p>

<p>Copy the <code>dnscrypt-proxy.exe</code> file to any location, then open a
terminal and type (eventually with the full path to <code>dnscrypt-proxy.exe</code>):</p>

<pre><code>dnscrypt-proxy.exe --install
</code></pre>

<p>It will install a new service named <code>dnscrypt-proxy</code>.</p>

<p>After being stopped, the service can be removed with:</p>

<pre><code>dnscrypt-proxy.exe --uninstall
</code></pre>

<p>See the <a
href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/README-WINDOWS.markdown">Using
DNSCrypt on Windows</a> file for more info on this topic.</p>

<h2>Using DNSCrypt in combination with a DNS cache</h2>

<p>The DNSCrypt proxy is <strong>not</strong> a DNS cache. This means that incoming
queries will <strong>not</strong> be cached and every single query will require a
round-trip to the upstream resolver.</p>

<p>For optimal performance, the recommended way of running DNSCrypt is to
run it as a forwarder for a local DNS cache, like <code>unbound</code> or
<code>powerdns-recursor</code>.</p>

<p>Both can safely run on the same machine as long as they are listening
to different IP addresses (preferred) or different ports.</p>

<p>If your DNS cache is <code>unbound</code>, all you need is to edit the
<code>unbound.conf</code> file and add the following lines at the end of the <code>server</code>
section:</p>

<pre><code>do-not-query-localhost: no

forward-zone:
  name: "."
  forward-addr: 127.0.0.1@40
</code></pre>

<p>The first line is not required if you are using different IP addresses
instead of different ports.</p>

<p>Then start <code>dnscrypt-proxy</code>, telling it to use a specific port (<code>40</code>, in
this example):</p>

<pre><code># dnscrypt-proxy --local-address=127.0.0.1:40 --daemonize
</code></pre>

<h2>IPv6 support</h2>

<p>IPv6 is fully supported. IPv6 addresses with a port number should be
specified as [ip]:port</p>

<pre><code># dnscrypt-proxy --local-address='[::1]:40' --daemonize
</code></pre>

<h2>Queries using nonstandard ports / over TCP</h2>

<p>Some routers and firewalls can block outgoing DNS queries or
transparently redirect them to their own resolver. This especially
happens on public Wifi hotspots, such as coffee shops.</p>

<p>As a workaround, the port number can be changed using
the <code>--resolver-port=&lt;port&gt;</code> option. For example, OpenDNS servers
reply to queries sent to ports 53, 443 and 5353.</p>

<p>By default, dnscrypt-proxy sends outgoing queries to UDP port 443.</p>

<p>In addition, the DNSCrypt proxy can force outgoing queries to be
sent over TCP. For example, TCP port 443, which is commonly used for
communication over HTTPS, may not be filtered.</p>

<p>The <code>--tcp-only</code> command-line switch forces this behavior. When
an incoming query is received, the daemon immediately replies with a
"response truncated" message, forcing the client to retry over TCP.
The daemon then authenticates the query and forwards it over TCP
to the resolver.</p>

<p><code>--tcp-only</code> is slower than UDP, and this workaround should never be used
except when bypassing a filter is actually required. Moreover,
multiple queries over a single TCP connections aren't supported yet.</p>

<h2>EDNS payload size</h2>

<p>DNS packets sent over UDP have been historically limited to 512 bytes,
which is usually fine for queries, but sometimes a bit short for
replies.</p>

<p>Most modern authoritative servers, resolvers and stub resolvers
support the Extension Mechanism for DNS (EDNS) that, among other
things, allows a client to specify how large a reply over UDP can be.</p>

<p>Unfortunately, this feature is disabled by default on a lot of
operating systems. It has to be explicitly enabled, for example by
adding <code>options edns0</code> to the <code>/etc/resolv.conf</code> file on most
Unix-like operating systems.</p>

<p><code>dnscrypt-proxy</code> can transparently rewrite outgoing packets before
authenticating them, in order to add the EDNS0 mechanism. By
default, a conservative payload size of 1252 bytes is advertised.</p>

<p>This size can be made larger by starting the proxy with the
<code>--edns-payload-size=&lt;bytes&gt;</code> command-line switch. Values up to 4096
are usually safe.</p>

<p>A value below or equal to 512 will disable this mechanism, unless a
client sends a packet with an OPT section providing a payload size.</p>

<h2>The <code>hostip</code> utility</h2>

<p>The DNSCrypt proxy ships with a simple tool named <code>hostip</code> that
resolves a name to IPv4 or IPv6 addresses.</p>

<p>This tool can be useful for starting some services before
<code>dnscrypt-proxy</code>.</p>

<p>Queries made by <code>hostip</code> are not authenticated.</p>

<h2>Additional documentation</h2>

<ul>
  <li><a
href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/README.markdown">dnscrypt-proxy
documentation</a></li>
  <li><a
href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/README-WINDOWS.markdown">using
dnscrypt on Windows</a></li>
  <li><a
href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/README-PLUGINS.markdown">dnscrypt-proxy
plugins and plugin API</a></li>
  <li><a
href="http://dnscrypt.org/plugin-api/plugin_8h.html">API reference</a></li>
  <li><a
href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/TECHNOTES">protocol
and implementation details</a></li>
  <li><a
href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/THANKS">thanks!</a></li>
</ul>

      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
